<ion-header>
    <ion-toolbar color="primary" class="with-back-button">
        <ion-buttons slot="start">
            <ion-back-button [defaultHref]="defaultBackUrl"></ion-back-button>
        </ion-buttons>
        <ng-container *ngIf="!isToDo">
            <ion-title *ngIf="commune else titleNoCommune">
                New activity @ {{commune.title}}
            </ion-title>
            <ng-template #titleNoCommune>New activity</ng-template>
        </ng-container>
        <ng-container *ngIf="isToDo">
            <ion-title *ngIf="commune else titleNoCommune">
                New task @ {{commune.title}}
            </ion-title>
            <ng-template #titleNoCommune>New task</ng-template>
        </ng-container>
    </ion-toolbar>
</ion-header>

<ion-content>

    <div class="segment">
        <ion-segment [(ngModel)]="happeningKind" (ionChange)="segmentChanged()">
            <ion-segment-button value="regular">Regular</ion-segment-button>
            <ion-segment-button value="single" *ngIf="!isToDo">Event</ion-segment-button>
            <ion-segment-button value="single" *ngIf="isToDo">Once</ion-segment-button>
        </ion-segment>
    </div>

    <form [formGroup]="activityForm" (ngSubmit)="createActivity()">
        <ion-item>
<!--            <ion-label>Title</ion-label>-->
            <ion-input placeholder="Title" style="font-weight: bold" type="text" formControlName="title" #titleInput (keyup.enter)="createActivity()"></ion-input>
        </ion-item>
        <ion-item>
            <ng-container *ngIf="isToDo">
                <ion-label>Cost</ion-label>
            </ng-container>
            <ng-container *ngIf="!isToDo">
                <ion-label *ngIf="happeningKind === 'regular'">Price per visit</ion-label>
                <ion-label *ngIf="happeningKind === 'single'">Price</ion-label>
            </ng-container>
            <ion-input type="number" style="text-align: right"></ion-input>
        </ion-item>
    </form>

    <ion-item-group>
        <ion-item-divider color="light" *ngIf="happeningKind === 'regular' && !isToDo">
            <ion-label>When & Where</ion-label>
            <ion-buttons slot="end" *ngIf="slots.length && !showSlotForm">
                <ion-button title="Add slot" (click)="newSlot()">
                    <ion-icon name="add"></ion-icon>
                </ion-button>
            </ion-buttons>
        </ion-item-divider>
        <app-regular-slots [slots]="slots"
                           (slotRemoved)="onSlotRemoved($event)"
        ></app-regular-slots>
        <ng-container *ngIf="showSlotForm">
            <app-regular-slot-form [happeningKind]="happeningKind"
                                   [isToDo]="isToDo"
                                   [slots]="slots"
                                   (slotAdded)="onSlotAdded()"
                                   (eventTimesChanged)="onEventTimesChanged($event)"
            ></app-regular-slot-form>
        </ng-container>
    </ion-item-group>

    <!--    <div [style.display]="happeningKind === 'single' || !showSlotForm && slots.length ? '' : 'none'">-->
    <div>
        <ion-item-group>
            <ng-container *ngIf="members else noMembers">
                <ion-radio-group>
                    <ng-container *ngIf="adults.length">
                        <ion-item-divider color="light">
                            <ion-label *ngIf="isToDo">Assign to (adults)</ion-label>
                            <ion-label *ngIf="!isToDo">Attendees (adults)</ion-label>
                            <ion-buttons slot="end">
                                <ion-button title="Add member">
                                    <ion-icon name="add"></ion-icon>
                                </ion-button>
                            </ion-buttons>
                        </ion-item-divider>
                        <ion-item *ngFor="let member of adults; trackBy: trackById">
                            <ion-label>{{member.title || member.id}}</ion-label>
                            <ion-checkbox slot="start" *ngIf="!isToDo"></ion-checkbox>
                            <ion-radio slot="start" *ngIf="isToDo" [value]="member.id"></ion-radio>
                        </ion-item>
                    </ng-container>
                    <ng-container *ngIf="kids.length">
                        <ion-item-divider color="light">
                            <ion-label *ngIf="isToDo">Assign to (kids)</ion-label>
                            <ion-label *ngIf="!isToDo">Attendees (kids)</ion-label>
                            <ion-buttons slot="end">
                                <ion-button title="Add member">
                                    <ion-icon name="add"></ion-icon>
                                </ion-button>
                            </ion-buttons>
                        </ion-item-divider>
                        <ion-item *ngFor="let member of kids; trackBy: trackById">
                            <ion-label>{{member.title || member.id}}</ion-label>
                            <ion-checkbox slot="start" *ngIf="!isToDo" [checked]="member.isChecked"
                                          (ionChange)="onMemberSelectChanged(member, $event)"></ion-checkbox>
                            <ion-radio slot="start" *ngIf="isToDo" [value]="member.id"></ion-radio>
                        </ion-item>
                    </ng-container>
                </ion-radio-group>
            </ng-container>
            <ng-template #noMembers>
                <ion-item>
                    <ion-label>Loading members...</ion-label>
                </ion-item>
            </ng-template>
        </ion-item-group>
        <ion-item-group>
            <ion-item-divider color="light">
                <ion-label>Teachers & Contacts</ion-label>
                <ion-buttons slot="end">
                    <ion-button (click)="addContact()" title="Add contact">
                        <ion-icon name="add"></ion-icon>
                    </ion-button>
                </ion-buttons>
            </ion-item-divider>
            <p padding *ngIf="!contacts.length">
                You can specify who teaches a lesson or a babysitter brings your kids to the class.
            </p>
            <ng-container *ngIf="contacts.length">
                <ion-item>
                    <ion-label>Superman</ion-label>
                    <ion-badge>Teacher</ion-badge>
                </ion-item>
                <ion-item *ngIf="contacts.length > 1">
                    <ion-label>Alison</ion-label>
                    <ion-badge color="medium">Babysitter</ion-badge>
                </ion-item>
                <ion-item *ngIf="contacts.length > 2">
                    <ion-label>Bob</ion-label>
                    <ion-badge color="light">co-participant</ion-badge>
                </ion-item>
            </ng-container>
        </ion-item-group>

        <div class="ion-padding">
            <ng-container *ngIf="isToDo">
                <ion-button size="large" (click)="createActivity()">
                    Add task
                </ion-button>
            </ng-container>
            <ion-button *ngIf="!isToDo" size="large" (click)="createActivity()">
                <ng-container *ngIf="happeningKind === 'regular'">Add activity</ng-container>
                <ng-container *ngIf="happeningKind === 'single'">Add event</ng-container>
            </ion-button>
        </div>
    </div>

    <ion-list>
        <ion-item color="danger" *ngIf="activityForm.touched && activityForm.controls['title'].errors">
            <ng-container *ngIf="isToDo">Task title is required.</ng-container>
            <ng-container *ngIf="!isToDo">Activity title is required.</ng-container>
        </ion-item>
        <!--<ion-item color="danger" *ngIf="weekdaysForm.touched && weekdaysForm.errors && weekdaysForm.errors['required']">-->
        <!--{{ weekdaysForm.errors['required'] }}-->
        <!--</ion-item>-->
    </ion-list>
</ion-content>
