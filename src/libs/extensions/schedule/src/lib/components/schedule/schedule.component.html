<ion-segment class="ion-padding-horizontal" [(ngModel)]="tab" (ionChange)="segmentChanged($event)">
	<ion-segment-button value="day">Day</ion-segment-button>
	<ion-segment-button value="week">Week</ion-segment-button>
	<ion-segment-button value="recurrings">Recurring</ion-segment-button>
	<ion-segment-button value="singles">One-timers</ion-segment-button>
</ion-segment>

<ion-card>
	<ion-item class="with-buttons" *ngIf="tab === 'day' || tab === 'week'">
		<ion-label>
			<div class="virtual-slider-outer" (swipeleft)="swipeLeft()" (swiperight)="swipeRight()">
				<div class="virtual-slider-inner" [@virtualSlider]="dayAnimationState" *ngIf="tab === 'day'">
					<h1 class="virtual-slide" [@virtualSlide]="oddDay.animationState">
						<span *ngIf="isToday()" class="ion-margin-end">Today:</span>
						<span *ngIf="isTomorrow()" class="ion-margin-end">Tomorrow:</span>
						<ng-container *ngIf="oddDay.weekday">
							<b>{{oddDay.weekday.id|wdToWeekday}}</b><span
							style="font-weight: normal">, {{oddDay.date?.getDate()}} {{oddDay.date?.getMonth()|longMonthName}}</span>
						</ng-container>
					</h1>

					<h1 class="virtual-slide" [@virtualSlide]="evenDay.animationState">
						<span *ngIf="isToday()" class="ion-margin-end">Today:</span>
						<span *ngIf="isTomorrow()" class="ion-margin-end">Tomorrow:</span>
						<ng-container *ngIf="evenDay.weekday">
							<b>{{evenDay.weekday.id|wdToWeekday}}</b><span
							style="font-weight: normal">, {{evenDay.date?.getDate()}} {{evenDay.date?.getMonth()|longMonthName}}</span>
						</ng-container>
					</h1>
				</div>
				<div *ngIf="tab === 'week'" class="virtual-slider-inner" [@virtualSlider]="weekAnimationState">
					<h1 *ngIf="oddWeek.startDate" class="virtual-slide" [@virtualSlide]="oddWeek.animationState">
						{{oddWeek.startDate?.getDate()}} {{oddWeek.startDate?.getMonth()|shortMonthName}}
						&mdash;
						{{oddWeek.endDate?.getDate()}} {{oddWeek.endDate?.getMonth()|shortMonthName}}
					</h1>
					<h1 class="virtual-slide" [@virtualSlide]="evenWeek.animationState">
						<ng-container *ngIf="evenWeek.startDate">
							{{evenWeek.startDate?.getDate()}} {{evenWeek.startDate?.getMonth()|shortMonthName}}
							&mdash;
							{{evenWeek.endDate?.getDate()}} {{evenWeek.endDate?.getMonth()|shortMonthName}}
						</ng-container>
					</h1>
				</div>
			</div>
		</ion-label>

		<ion-buttons slot="end" >
			<ion-button title="Add" (click)="goNewHappening({type: 'single', date: activeDay.date})">
				<ion-icon name="add-circle-outline" slot="start"></ion-icon>
			</ion-button>
			<ion-button [title]="tab === 'day' ? 'Previous day' : 'Previous week'"
									(click)="changeDay(tab === 'day' ? -1 : -7)">
				<ion-icon name="chevron-back-sharp"></ion-icon>
			</ion-button>
			<ion-button [disabled]="isToday()"
									[color]="isToday() ? 'medium' : 'primary'"
									[title]="tab === 'day' ? 'Today' : 'This week'"
									(click)="setToday()">
				<ion-icon slot="start" name="today-outline"></ion-icon>
			</ion-button>
			<ion-button [title]="tab === 'day' ? 'Next day' : 'Next week'"
									(click)="changeDay(tab === 'day' ? +1 : +7)">
				<ion-icon name="chevron-forward-sharp"></ion-icon>
			</ion-button>
		</ion-buttons>
	</ion-item>

	<!--	<ion-list lines="none" class="no-v-padding" *ngIf="tab === 'day' || tab === 'week'">-->
	<!--		<ion-grid class="grid-layout">-->
	<!--			<ion-row>-->
	<!--				<ion-col [size]="filter.length > 4 ? 6 : 4">-->
	<!--					<sneat-filter-item [filter]="filter" (changed)="applyFilter($event)"-->
	<!--														 (blur)="filterFocused = false"></sneat-filter-item>-->
	<!--				</ion-col>-->
	<!--				<ion-col [size]="filter.length > 4 ? 3 : 4">-->
	<!--					<ion-item style="border-bottom: none; padding: 0">-->
	<!--						<ion-checkbox slot="start"-->
	<!--													color="light"-->
	<!--													checked="true"-->
	<!--													[(ngModel)]="showRecurring"-->
	<!--													(ionChange)="onShowRecurringsChanged()"-->
	<!--						>-->
	<!--						</ion-checkbox>-->
	<!--						<ion-label color="medium">-->
	<!--							<small>Regular</small>-->
	<!--						</ion-label>-->
	<!--					</ion-item>-->
	<!--				</ion-col>-->
	<!--				<ion-col [size]="filter && filter.length > 4 ? 3 : 4">-->
	<!--					<ion-item>-->
	<!--						<ion-checkbox slot="start"-->
	<!--													color="light"-->
	<!--													checked="true"-->
	<!--													[(ngModel)]="showEvents"-->
	<!--													(ionChange)="onShowEventsChanged()"-->
	<!--						>-->
	<!--						</ion-checkbox>-->
	<!--						<ion-label color="medium">-->
	<!--							<small>Events</small>-->
	<!--						</ion-label>-->
	<!--					</ion-item>-->
	<!--				</ion-col>-->
	<!--			</ion-row>-->
	<!--		</ion-grid>-->
	<!--	</ion-list>-->

	<!--	<sneat-filter-item *ngIf="tab === 'regular' || tab === 'events'" [filter]="filter"-->
	<!--										 (changed)="applyFilter($event)"></sneat-filter-item>-->

	<!--	<ion-segment [(ngModel)]="filterSegment" *ngIf="tab === 'day' || tab === 'week'">-->
	<!--		<ion-segment-button value="all">All</ion-segment-button>-->
	<!--		<ion-segment-button value="mine">Mine only</ion-segment-button>-->
	<!--		<ion-segment-button value="others">Others</ion-segment-button>-->
	<!--	</ion-segment>-->

	<!--	<ng-container *ngIf="filterSegment==='filter'">-->
	<!--		<ion-item>-->
	<!--			<ion-label>Member</ion-label>-->
	<!--			<ion-select value="all">-->
	<!--				<ion-select-option value="all">All</ion-select-option>-->
	<!--			</ion-select>-->
	<!--		</ion-item>-->
	<!--		<ion-item>-->
	<!--			<ion-label>Assets</ion-label>-->
	<!--			<ion-select value="all">-->
	<!--				<ion-select-option value="all">All</ion-select-option>-->
	<!--			</ion-select>-->
	<!--		</ion-item>-->
	<!--	</ng-container>-->


	<div *ngIf="tab === 'day' && activeDay?.date" style="margin-top: 1em">
		<!--		<p class="ion-margin-horizontal">-->
		<!--			oddDay.weekday: {{oddDay.weekday|json}}-->
		<!--			activeDay.parity: {{activeDay.parity}},-->
		<!--			activeDayParity: {{activeDayParity}},-->
		<!--			activeDay.weekday: {{activeDay.weekday|json}}-->
		<!--		</p>-->
		<div class="virtual-slider-outer" (swipeleft)="swipeLeft()" (swiperight)="swipeRight()">
			<div class="virtual-slider-inner" [@virtualSlider]="dayAnimationState">
				<div class="virtual-slide" [@virtualSlide]="oddDay.animationState">
					<sneat-schedule-day
						[filter]="filter"
						[showEvents]="showEvents"
						[showRegulars]="showRecurrings"
						[weekday]="oddDay.weekday"
						(slotClicked)="onSlotClicked($event)"
					></sneat-schedule-day>
					<div class="virtual-slide-overflow-fixer"></div>
				</div>
				<div class="virtual-slide" [@virtualSlide]="evenDay.animationState">
					<sneat-schedule-day
						[weekday]="evenDay.weekday"
						(slotClicked)="onSlotClicked($event)"
					></sneat-schedule-day>
					<div class="virtual-slide-overflow-fixer"></div>
				</div>
			</div>
		</div>
	</div>
	<div *ngIf="tab === 'week' && activeWeek">
		<div class="virtual-slider-outer" (swipeleft)="swipeLeft()" (swiperight)="swipeRight()">
			<div class="virtual-slider-inner" [@virtualSlider]="weekAnimationState">
				<div class="virtual-slide" [@virtualSlide]="oddWeek.animationState">
					<sneat-schedule-week
						[week]="oddWeek"
						[teamDaysProvider]="teamDaysProvider"
						[filter]="filter"
						[showEvents]="showEvents"
						[showRecurring]="showRecurrings"
						(goNew)="goNewHappening($event)"
						(dateSelected)="onDateSelected($event)"
						(slotClicked)="onSlotClicked($event)"></sneat-schedule-week>
					<div class="virtual-slide-overflow-fixer"></div>
				</div>
				<div class="virtual-slide" [@virtualSlide]="evenWeek.animationState">
					<sneat-schedule-week
						[week]="evenWeek"
						[teamDaysProvider]="teamDaysProvider"
						[filter]="filter"
						[showEvents]="showEvents"
						[showRecurring]="showRecurrings"
						(goNew)="goNewHappening($event)"
						(dateSelected)="onDateSelected($event)"
						(slotClicked)="onSlotClicked($event)"></sneat-schedule-week>
					<div class="virtual-slide-overflow-fixer"></div>
				</div>
			</div>
		</div>
	</div>

	<ng-container *ngIf="tab === 'recurrings'">
		<div class="ion-padding" *ngIf="!recurrings">
			<p>Loading...</p>
		</div>
		<ng-container *ngIf="recurrings">
			<p *ngIf="!recurrings?.length && !allRecurrings?.length" padding>No recurring activities added yet.</p>
			<p *ngIf="!recurrings?.length && allRecurrings?.length" padding>No recurring activities matching filter.</p>
			<ion-item-group *ngFor="let recurring of recurrings; trackBy: id">
				<ion-item color="light" button (click)="goRegular(recurring)">
					<ion-label>
						<h2><b>{{recurring.brief.type|titlecase}}</b>: <span
							style="font-weight: normal">{{recurring.brief.title}}</span>
						</h2>
						<p *ngIf="recurring.dto?.participants?.length">
							<ion-badge color="medium" style="margin-right: 0.5em"
												 *ngFor="let participant of recurring.dto?.participants; trackBy: id">
								{{participant.title}}
							</ion-badge>
						</p>
					</ion-label>
				</ion-item>
				<ion-item button *ngFor="let slot of recurring.brief.slots; trackBy: index" (click)="goRegular(recurring)">
					<ion-badge color="light" slot="start">{{slot.start.time}}</ion-badge>
					<ion-label text-wrap>
						<p>
							<ion-badge color="light" style="margin-right: 4px;"
												 *ngFor="let wd of slot.weekdays">{{wd|wdToWeekday}}</ion-badge>
						</p>
						<p *ngIf="slot.location && (slot.location.title || slot.location.address) else noLocation">
							@ {{slot.location.title || slot.location.address}},
							ends at {{slot.end?.time}}</p>
						<ng-template #noLocation>
							<p>Ends at {{slot.end?.time}}</p>
						</ng-template>
					</ion-label>
				</ion-item>
			</ion-item-group>
		</ng-container>
	</ng-container>

	<ng-container *ngIf="tab === 'singles'">
		<p padding *ngIf="!todayAndFutureDays">Loading...</p>
		<p padding *ngIf="todayAndFutureDays && todayAndFutureDays.length === 0">No upcoming events.</p>
		<ng-container *ngIf="todayAndFutureDays && todayAndFutureDays.length">
			<ng-container *ngFor="let weekday of todayAndFutureDays; trackBy: trackByDate">
				<sneat-schedule-weekday [weekday]="weekday"
																[filter]="filter"
																[showEvents]="true"
																(slotClicked)="onSlotClicked($event)"
																(dateSelected)="onDateSelected($event)"
																(goNew)="goNewHappening($event)"
				></sneat-schedule-weekday>
			</ng-container>
		</ng-container>
	</ng-container>
</ion-card>

<div class="ion-padding-bottom ion-text-center" *ngIf="tab === 'day' || tab === 'week'">
	<ion-text color="medium">
		&larr;
		<span *ngIf="tab === 'day'">Swipe to change day</span>
		<span *ngIf="tab === 'week'">Swipe to change week</span>
		&rarr;
	</ion-text>
</div>

