<ion-header>
	<ion-toolbar color="primary" class="with-back-button with-end-buttons">
		<ion-buttons slot="start">
			<ion-back-button [defaultHref]="defaultBackUrl"></ion-back-button>
		</ion-buttons>
		<sneat-commune-page-title
			[commune]="commune"
			[generalTitle]="pageTitle"
			[icon]="titleIcon"
			[titlesByTeamType]="{
				personal: 'Personal contacts',
				family: 'Family contacts'
			}">
		</sneat-commune-page-title>
		<ion-buttons slot="end">
			<ion-menu-button menu="mainMenu"></ion-menu-button>
		</ion-buttons>
	</ion-toolbar>
</ion-header>

<ion-content>
	<sneat-filter-item (changed)="applyFilter($event, role)"></sneat-filter-item>

	<div class="segment" *ngIf="!role">
		<ion-segment [(ngModel)]="segment">
			<ion-segment-button value="list">
				<ion-label>List</ion-label>
			</ion-segment-button>
			<ion-segment-button value="groups">
				<ion-label>Groups</ion-label>
			</ion-segment-button>
		</ion-segment>
	</div>

	<ion-list *ngIf="segment === 'list'">
		<ion-item-sliding @listItem *ngFor="let contact of contacts; trackBy: trackById">
			<contactus-contact-item [contact]="contact" [goContact]="goContact" [goMember]="goMember"
											[excludeRole]="role"></contactus-contact-item>
		</ion-item-sliding>
		<ion-item button (click)="goNewContact()" *ngIf="canAdd">
			<ion-icon name="add" color="primary"></ion-icon>
			<ion-label color="primary">Add contact</ion-label>
		</ion-item>
	</ion-list>

	<ion-list *ngIf="segment === 'groups'">
		<ng-container *ngIf="commune && commune.type === 'family'">
			<contactus-contacts-family [contacts]="allContacts" [goContact]="goContact" [goMember]="goMember"
												[commune]="commune" [filter]="filter"></contactus-contacts-family>
		</ng-container>

		<ng-container *ngIf="groups">
			<ion-item *ngFor="let group of groups; trackBy: trackById" (click)="goGroup(group)" tappable>
				<ion-label>
					{{group.title}}
				</ion-label>
				<ion-badge color="light" *ngIf="group.numberOf && group.numberOf.members">
					{{group.numberOf.members}}
				</ion-badge>
			</ion-item>
		</ng-container>
	</ion-list>
</ion-content>

<ion-footer>
	<ion-toolbar color="light">
		<ion-label *ngIf="contacts">
			<b>Total</b>: {{ contacts.length }} {{contacts.length === 1 ? 'contact' : 'contacts'}}
		</ion-label>
		<ion-label *ngIf="!contacts">Loading...</ion-label>
		<ion-buttons slot="end">
			<ion-button *ngIf="canAdd"
							color="primary"
							size="small"
							(click)="goNewContact()"
							[title]="'Add contact'">
				<ion-icon name="add"></ion-icon>
				Add
			</ion-button>
		</ion-buttons>
	</ion-toolbar>
</ion-footer>

