<ion-header>
	<ion-toolbar>
		<ion-buttons slot="start">
			<ion-back-button defaultHref="/"></ion-back-button>
		</ion-buttons>
		<ion-title>Queries</ion-title>
		<ion-buttons slot="end">
			<ion-button (click)="reloadQueries()">
				<ion-icon name="reload-outline"></ion-icon>
			</ion-button>
		</ion-buttons>
	</ion-toolbar>
</ion-header>

<ion-content class="cards">

	<ion-segment [(ngModel)]="tab" class="ion-padding-start ion-padding-end">
		<ion-segment-button value="all">All</ion-segment-button>
		<ion-segment-button value="bookmarked">Bookmarked</ion-segment-button>
		<ion-segment-button value="new">New</ion-segment-button>
		<ion-segment-button value="recent">Recent</ion-segment-button>
		<ion-segment-button value="popular">Popular</ion-segment-button>
	</ion-segment>
	<ion-segment [(ngModel)]="type" class="ion-padding-start ion-padding-end" color="medium">
		<ion-segment-button value="*">Any kind</ion-segment-button>
		<ion-segment-button value="SQL">SQL</ion-segment-button>
		<ion-segment-button value="GraphQL">GraphQL</ion-segment-button>
		<ion-segment-button value="HTTP">HTTP(s)</ion-segment-button>
	</ion-segment>
	<ion-card *ngIf="tab !== 'all'">
		<ion-card-content>
			<p>{{tab}} &mdash; not implemented yet</p>
		</ion-card-content>
	</ion-card>
	<ion-card *ngIf="tab === 'all'">
		<ng-container *ngIf="currentFolder; else loader">
			<ion-item>
				<ion-input [disabled]="!currentFolder" placeholder="Filter" [(ngModel)]="filter"
							  (ionChange)="applyFilter()"></ion-input>
			</ion-item>
			<!--			<ion-item>-->
			<!--				<ion-label>Tags:</ion-label>-->
			<!--				<ion-badge slot="end" color="secondary">-->
			<!--					tag1-->
			<!--					<ion-icon name="close" tappable></ion-icon>-->
			<!--				</ion-badge>-->
			<!--			</ion-item>-->
			<ion-item tappable *ngIf="folderPath" (click)="cd('..')">
				<ion-icon name="folder-open-outline" slot="start"></ion-icon>
				<ion-label>..</ion-label>
			</ion-item>
			<ng-container *ngIf="filter">
				<ion-item *ngFor="let item of filteredItems">
					<ion-label>
						{{item.query.title}}
						<p *ngIf="item.folders?.length">
							<ion-text color="medium">Folder:&nbsp;</ion-text>
							<code><span *ngFor="let p of item.folders">{{p}}/</span></code>
						</p>
					</ion-label>
				</ion-item>
			</ng-container>
			<ng-container *ngIf="!filter && currentFolder?.queries">
				<ng-container *ngFor="let query of currentFolder.queries">
					<ng-container *ngIf="type === '*' || query.type === 'folder' || query.type === type">
						<ion-item tappable *ngIf="query.type === 'folder'; else notFolder" (click)="cd(query.id)">
							<ion-icon name="folder-outline" slot="start" color="primary"></ion-icon>
							<ion-label>{{query.id}}</ion-label>
						</ion-item>
						<ng-template #notFolder>
							<ion-item tappable (click)="goQuery(query)">
								<ion-icon name="document-text-outline" slot="start"></ion-icon>

								<ion-label *ngIf="query.type !== 'folder'">
									<h3 style="display: inline;font-size: large">
										{{query.title}}
									</h3>
									<span class="ion-margin-start" *ngIf="query.targets?.length">
									<ion-badge *ngFor="let target of query.targets">{{target?.catalog}}</ion-badge>
								</span>
								</ion-label>


								<ion-badge slot="end" color="secondary">{{query.type}}</ion-badge>

								<ion-buttons slot="end" class="ion-no-margin">
									<ion-button color="medium" title="Edit" (click)="goQuery(query, 'edit')">
										<ion-icon slot="start" name="create-outline"></ion-icon>
									</ion-button>
									<ion-button color="medium" title="Execute" (click)="goQuery(query, 'execute')">
										<ion-icon slot="start" name="play-outline"></ion-icon>
									</ion-button>
								</ion-buttons>

							</ion-item>
							<ion-item>
								<small>
									<small>
										<datatug-sql [sql]="query.text"></datatug-sql>
									</small>
								</small>
								<!--							<pre *ngIf="query.text" style="font-size: smaller">{{query.text}}</pre>-->
							</ion-item>
						</ng-template>
					</ng-container>
				</ng-container>
			</ng-container>
		</ng-container>
		<ng-template #loader>
			<ion-item>
				<ion-label>Loading queries...</ion-label>
			</ion-item>
		</ng-template>
		<!--		<ion-item class="sql-editor ion-margin ion-no-padding" style="min-height: 0">-->
		<!--			<ngx-codemirror style="height: auto" #codemirrorComponent [(ngModel)]="sql"-->
		<!--								 [options]="codemirrorOptions"></ngx-codemirror>-->
		<!--			<ion-buttons slot="end" class="ion-no-margin">-->
		<!--				<ion-button color="medium" routerLink="./query123">-->
		<!--					<ion-icon slot="start" name="create-outline"></ion-icon>-->
		<!--					<ion-label>Edit</ion-label>-->
		<!--				</ion-button>-->
		<!--				<ion-button color="medium" routerLink="./query123">-->
		<!--					<ion-icon slot="start" name="play-outline"></ion-icon>-->
		<!--					<ion-label>Execute</ion-label>-->
		<!--				</ion-button>-->
		<!--			</ion-buttons>-->
		<!--		</ion-item>-->

	</ion-card>
</ion-content>
